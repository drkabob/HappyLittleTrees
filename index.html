<html>
  <head>
    <!-- stylesheet -->
    <link href="/css/literallycanvas.css" rel="stylesheet">

    <!-- dependency: React.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js"></script>

    <!-- Literally Canvas -->
    <script src="/js/literallycanvas.js"></script>

    <script src="/js/resemble.js"></script>

    <style>
    </style>

  </head>
  <body>
    <!-- where the widget goes. you can do CSS to it. -->
    <div class="literally"></div>
    Mismatch: <span id="mismatch">100%</span>
    <input type="button" id="check" value="Check"></input>
    <input type="button" id="dl" value="Download"></input>

    <!-- kick it off -->
    <script>
        // Look ma, no jQuery!
        var lc = LC.init(
            document.getElementsByClassName('literally')[0],
            {imageURLPrefix: '/img'}
        );
        var context = lc.ctx;
        var myImage = new Image();
        myImage.src = "http://localhost:8000/paintings/ross1.jpg";
        lc.setImageSize(myImage.naturalWidth, myImage.naturalHeight);
        function drawImage() {
            context.globalAlpha = 0.5;
            context.drawImage(myImage, 0, 0);
            context.globalAlpha = 1.0;
        }

        function updateMatch() {
            var diff = resemble(lc.getImage().toDataURL())
                .compareTo(myImage.src)
                .onComplete(function(data){
                    document.getElementById("mismatch").innerHTML =
                        data.misMatchPercentage + "%";
             });
            diff.ignoreAntialiasing();
        }

        document.getElementById("check").onclick = updateMatch;
        document.getElementById("dl").onclick = function() {
            window.open(lc.getImage().toDataURL());
        };

        myImage.onload = drawImage;
        var unsubscribe = lc.on('drawingChange', drawImage);
        var unsubscribe = lc.on('shapeSave', drawImage);
        var unsubscribe = lc.on('clear', drawImage);
        var unsubscribe = lc.on('undo', drawImage);
        var unsubscribe = lc.on('redo', drawImage);
        var unsubscribe = lc.on('primaryColorChange', drawImage);
        var unsubscribe = lc.on('secondaryColorChange', drawImage);
        var unsubscribe = lc.on('backgroundColorChange', drawImage);

    </script>
  </body>
</html>
